<UserControl x:Class="ClinicApp.Wpf.Views.PatientsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="900">
    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <TextBlock Text="Управление пациентами" Style="{StaticResource MaterialDesignHeadline4TextBlock}" Margin="0,0,0,24"/>

        <!-- Search and Add Form -->
        <materialDesign:Card Grid.Row="1" Padding="24" Margin="0,0,0,24" UniformCornerRadius="8">
            <StackPanel>
                <Grid Margin="0,0,0,24">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox materialDesign:HintAssist.Hint="Поиск по фамилии, имени или телефону" 
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}" 
                             Margin="0,0,16,0"/>
                    <Button Grid.Column="1" Content="ПОИСК" 
                            Command="{Binding SearchCommand}" 
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            Padding="32,0"/>
                </Grid>

                <TextBlock Text="Добавить нового пациента" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,16"/>
                <UniformGrid Columns="4">
                    <TextBox materialDesign:HintAssist.Hint="Фамилия" 
                             Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                             Text="{Binding LastName, UpdateSourceTrigger=PropertyChanged}" Margin="8"/>
                    <TextBox materialDesign:HintAssist.Hint="Имя" 
                             Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                             Text="{Binding FirstName, UpdateSourceTrigger=PropertyChanged}" Margin="8"/>
                    <TextBox materialDesign:HintAssist.Hint="Телефон" 
                             Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                             Text="{Binding Phone, UpdateSourceTrigger=PropertyChanged}" Margin="8"/>
                    <DatePicker materialDesign:HintAssist.Hint="Дата рождения" 
                                Style="{StaticResource MaterialDesignFloatingHintDatePicker}"
                                SelectedDate="{Binding DateOfBirth}" Margin="8"/>
                </UniformGrid>
                <Button Content="ДОБАВИТЬ ПАЦИЕНТА" 
                        Command="{Binding AddPatientCommand}" 
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        HorizontalAlignment="Right" Margin="8,16,8,0" Padding="32,0"/>
            </StackPanel>
        </materialDesign:Card>

        <!-- Patients List -->
        <materialDesign:Card Grid.Row="2" UniformCornerRadius="8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <DataGrid ItemsSource="{Binding Patients}" 
                          SelectedItem="{Binding SelectedPatient}"
                          AutoGenerateColumns="False" 
                          IsReadOnly="True"
                          SelectionMode="Single"
                          Style="{StaticResource MaterialDesignDataGrid}">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="60"/>
                        <DataGridTextColumn Header="Фамилия" Binding="{Binding LastName}" Width="*"/>
                        <DataGridTextColumn Header="Имя" Binding="{Binding FirstName}" Width="*"/>
                        <DataGridTextColumn Header="Телефон" Binding="{Binding Phone}" Width="*"/>
                        <DataGridTextColumn Header="Дата рождения" Binding="{Binding DateOfBirth, StringFormat=d}" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>

                <Button Grid.Row="1" Content="УДАЛИТЬ ВЫБРАННОГО" 
                        Command="{Binding DeletePatientCommand}" 
                        Style="{StaticResource MaterialDesignFlatButton}"
                        HorizontalAlignment="Left" Margin="16" Foreground="Red"/>
            </Grid>
        </materialDesign:Card>

        <!-- Loading Overlay -->
        <Grid Grid.RowSpan="3" Background="#80FFFFFF" Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}">
            <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}" 
                         Value="0" IsIndeterminate="True" Width="64" Height="64"/>
        </Grid>
    </Grid>
</UserControl>
